Jet().$package(qqweb.app.appBar=new qqweb.businessClass.App(qqweb.portal.getSystemConfig("appBar")),function(j){var D=this,B=j.dom,A=j.event,s=j.string,g=qqweb.layout.getDesktop().body,k=qqweb.layout.getPanel("statusBar").body,E,y,m,Y,u,n,V=false,U,F,W,h,M,S,P,H,l={},e=90,c=68,Z=93,t=6,q=66,X=30,R=110,w=150,v=160,b=30+30,a,Q,O,i,p,K,L,C,I,z,r="请输入搜索内容...",f={},T;var d=function(aa){E=B.node("div",{id:"appBarContainer","class":"appBarContainer"});var ab='				<div id="appBar" class="appBar">					<div class="appBar_inner">						<div class="appBar_bg_container">							<div class="appBar_bg appBar_bg_r"></div>							<div class="appBar_bg appBar_bg_l"></div>							<div class="appBar_bg appBar_bg_c"></div>						</div>						<div id="appBar_body" class="appBar_body">							<div id ="appBar_left" class ="appBar_left">								<div id="appBar_controlBar_market" class="appBar_controlBar_market">									<div id="appBar_controlBar_market_tips" class="appBar_controlBar_market_tips"></div>									<div id="appBar_controlBar_market_icon" class="appBar_controlBar_market_icon"></div>									<span id="appBar_controlBar_market_text" class="appBar_controlBar_market_text">应用市场</span>								</div>								<div id="appButtonsArea" class="appButtonsArea">									<div id="appButtonsArea_inner" class="appButtonsArea_inner"></div>								</div>								<a id="appBar_controlBar_all" class="appBar_controlBar_all" href="###" title="应用面板" hidefocus></a>							</div>							<div class="appBar_spilter" id="appBar_spilter"></div>							<div style="display:none" id="appBar_spilter_ipad"></div>							<div id="appBar_searchArea" class="appbar_searchArea">								<div class="appBar_sosobg_container">									<div class="appBar_sosobg appBar_sosobg_r"></div>									<div class="appBar_sosobg appBar_sosobg_l"></div>									<div class="appBar_sosobg appBar_sosobg_c"></div>								</div>								<div class="appBar_sosobody">									<input type="text" name="searchKey" value="" class="searchInputTxt unfocus" id="searchKey">								</div>								<div title="搜索..." id="appbar_searchSearchBtn" class="appbar_searchSearchBtn">&nbsp; </div>							</div>						</div>					</div>				</div>';E.innerHTML=ab;g.appendChild(E);y=B.id("appBar_body");m=B.id("appButtonsArea");Y=B.id("appButtonsArea_inner");U=new j.ui.Sortables([Y],"appId");A.addObserver(U,"start",G.onBarDragStart);A.addObserver(U,"end",G.onBarDragEnd);var af=B.id("appBar_controlBar_market");M=B.id("appBar_controlBar_all");C=B.id("appBar_searchArea");I=B.id("searchKey");I.value=r;z=B.id("appbar_searchSearchBtn");K=B.id("appBar_spilter");L=B.id("appBar_left");B.hide(C);B.hide(K);B.hide(M);A.on(I,"keydown",G.onSearchKeyKeydown);A.on(I,"focus",G.onSearchKeyFocus);A.on(I,"blur",G.onSearchKeyBlur);A.on(I,"mousedown",G.onSearchKeyClick);A.on(I,"mouseup",G.onSearchKeyClick);A.on(z,"click",G.onSearch);A.on(af,"click",G.onControlBarMarketClick);A.on(M,"click",G.onControlBarAllClick);var J={xOnly:true};F=new j.ui.Drag(K,B.id("appBar_spilter_ipad"),J);A.addObserver(F,"start",j.bind(G.onSpliterDragStart,this));A.addObserver(F,"move",j.bind(G.onSpliterDragMove,this));A.addObserver(F,"end",j.bind(G.onSpliterDragEnd,this));A.on(E,"click",G.stopPropagation);A.on(window,"resize",G.onResizeAppBar);var ad='				<div class="appBarBox_outer" id="appBarBox_outer">					<div class="appBarBox_inner" id="appBarBox_inner">						<div class="appBarBox_bg_container" id="appBarBox_bg_container">							<div class="appBarBox_bg appBarBox_center"></div>							<div class="appBarBox_bg appBarBox_t"></div>							<div class="appBarBox_bg appBarBox_rt"></div>							<div class="appBarBox_bg appBarBox_r" id="appBarBox_r"></div>							<div class="appBarBox_bg appBarBox_rb"></div>							<div class="appBarBox_bg appBarBox_b"></div>							<div class="appBarBox_bg appBarBox_lb"></div>							<div class="appBarBox_bg appBarBox_l"></div>							<div class="appBarBox_bg appBarBox_lt"></div>						</div>						<div id="appBox_scollBar" class ="appBox_scollBar">							<div class="appBarBox_content" id="appBarBox_content"></div>						</div>						<div class="appBarBox_toolbar">							<div class="appBarBox_toolbar_del" id="appBarBox_toolbar_del" title="拖到这里删除应用"></div>							<a class="appBarBox_toolbar_market" id="appBarBox_toolbar_market" href="###" title="应用市场"></a>						</div>					</div>				</div>';i=B.node("div",{id:"appBar_popupContainer","class":"appBar_popupContainer"});qqweb.layout.getDesktop().body.appendChild(i);i.innerHTML=ad,Q=B.id("appBarBox_content");O=B.id("appBox_scollBar");S=B.id("appBar_popupContainer");P=B.id("appBarBox_toolbar_del");p=B.id("appBarBox_outer");var ae=B.id("appBarBox_toolbar_market");A.on(ae,"click",G.onToolbarMarketClick);A.on(i,"click",G.onPopupContainerMousedown);A.on(i,"click",G.stopPropagation);if(!j.cookie.get("notifyAppbar")){H=B.node("div",{id:"appBar_controlBar_tip","class":"appBar_controlBar_tip"});var ac='<div id="appBar_controlBar_tip_btn" class="appBar_controlBar_tip_btn"></div>';H.innerHTML=ac;qqweb.layout.getDesktop().body.appendChild(H);A.on(B.id("appBar_controlBar_tip_btn"),"click",G.onAppbarTipButtonClick);}if(!j.cookie.get("notifyAppmarket")){B.show(B.id("appBar_controlBar_market_tips"));}};var N=function(J,ae,ab){var ad=qqweb.CONST.PUB_APP_STATIC_URL+Math.floor(ae/1000)%1000+"/"+ae+"/images/";var af=qqweb.CONST.PRI_APP_STATIC_URL;if(ab&&ab.smallIcon){if(ab.smallIcon.indexOf("priapps")>-1){af=qqweb.CONST.PRI_APP_STATIC_URL2;}}var ag="";var aa=ab.type||ab;if((aa&"010")>0){if(ae>99999){ag=af+ab.midIcon;}else{ag=ad+"mid.png";}J.style.backgroundImage="url("+ag+")";qqweb.util.setPngForIE6(J,ag);}else{if((aa&"001")>0){if(ae>99999){ag=af+ab.smallIcon;}else{ag=ad+"small.png";}J.style.backgroundImage="url(./module/appbar/images/iconbg_3.png)";qqweb.util.setPngForIE6(J,"./module/appbar/images/iconbg_3.png");var ac=B.node("div",{"class":"AppBar_item_small_icon"});J.appendChild(ac);ac.style.backgroundImage="url("+ag+")";qqweb.util.setPngForIE6(ac,ag);}else{J.style.backgroundImage="url(./module/appbar/images/mid.png)";qqweb.util.setPngForIE6(J,"./module/appbar/images/mid.png");}}J.setAttribute("isLoadIcon",1);};var x=function(aa){var J='<div class="appbar_container"><div class="appbar_alert">'+j.string.encodeHtml(aa)+'</div></div><div class="window_controlArea" style="display: block; "><a id="appmarket_login" class="window_button window_ok" title="确定" href="###" hidefocus="" style="display: block; ">登&nbsp;&nbsp;录</a></div>';if(n){n.close();}n=new qqweb.businessClass.Window({title:"温馨提示",modeSwitch:true,dragable:true,resize:false,width:370,height:127,html:J,hasCloseButton:true,isSetCentered:true});n.setTopZIndex();A.on(B.id("appmarket_login"),"click",function(ac){ac.preventDefault();n.close();qqweb.portal.showLoginWindow("");});A.addObserver(n,"close",function(){n=null;});n.body.background="transparent";var ab=D.window;};var o=function(){for(var J in h){h[J].toggleDelButton();}};var G={onRunFirst:function(){d();A.addObserver(qqweb.config,"GetUserAppListSuccess",G.onGetUserAppListSuccess);A.addObserver(qqweb.config,"AddToQuickAppList",G.onAddToQuickAppList);A.addObserver(qqweb.config,"RemoveFolderByFolderId",G.onRemoveFolderByFolderId);A.addObserver(qqweb.config,"RemoveFromQuickAppList",G.onRemoveFromQuickAppList);A.addObserver(qqweb.appconfig,"ClearDefaultApp",G.onClearDefaultApp);A.addObserver(qqweb.appconfig,"UpdateAppConfig",G.onUpdateAppConfig);A.addObserver(qqweb.appconfig,"AddAppConfig",G.onAddAppConfig);A.addObserver(qqweb.appconfig,"RemoveAppConfig",G.onRemoveAppConfig);A.addObserver(qqweb.appconfig,"GetAppConfigComplete",G.onGetAppConfigComplete);A.addObserver(qqweb.appconfig,"GetDefaultAppConfigComplete",G.onGetAppConfigComplete);A.notifyObservers(qqweb.portal,"appbarReady");},onRun:function(){},onClickAppStartButton:function(aa){aa.preventDefault();var J=this.getAttribute("appId");if(J){qqweb.portal.runApp(J,{});var ab=this.getAttribute("appName");if(ab&&s.trim(ab)){pgvSendClick({hottag:"web2qq.AppBar.Shortcutapp."+ab});}}},onControlBarMarketClick:function(J){J.stopPropagation();J.preventDefault();if(qqweb.portal.getLoginLevel()>1){qqweb.portal.runApp("appMarket",{tab:2});D.hidePopup();pgvSendClick({hottag:"web2qq.AppBar.wmeun.marketButton"});j.cookie.set("notifyAppmarket",1,"qq.com","/",365*24);B.hide(B.id("appBar_controlBar_market_tips"));}else{x("您尚未登录，赶快登录去管理您喜爱的应用吧！");}},onControlBarAllClick:function(ad){ad.preventDefault();ad.stopPropagation();var aa=qqweb.config.getFolderList();var ac=Q;if(!h){h={};if(!j.platform.iPad){var ab={isDash:true,className:"appbar_dashed"};}else{var ab={};}W=new j.ui.Sortables([],"appId",ab);A.addObserver(W,"start",G.onBoxDragStart);A.addObserver(W,"end",G.onBoxDragEnd);if(!j.platform.iPad){D.scrollBar=new j.ui.ScrollBar(B.id("appBox_scollBar"));}else{B.setStyle(Q,"overflow-y","auto");B.setStyle(Q,"overflow-x","hidden");new j.ui.TouchScroller(Q);}for(var J in aa){h[aa[J].id]=new qqweb.app.appBar.FolderItem(aa[J],ac);}}D.togglePopup();},onSearchKeyKeydown:function(J){if(J.keyCode==13){G.onSearch();}},onAddToQuickAppList:function(ac){var ab=ac.appId=parseInt(ac.appId);var J=ac.index;var aa=B.id("appBar_"+ab+"Button");if(!aa){var ad=qqweb.appconfig.getAppConfig(ab);if(J){D.addAppButton(ad,J);}}},onRemoveFolderByFolderId:function(J){h[J].removeFolderItem();delete h[J];},onRemoveFromQuickAppList:function(aa){var J=B.id("appBar_"+aa+"Button");if(J){Y.removeChild(J);}},onSearchKeyFocus:function(J){if(I.value==r){I.value="";}this.select();B.removeClass(I,"unfocus");J.stopPropagation();},onSearchKeyBlur:function(J){if(I.value==""){I.value=r;B.addClass(I,"unfocus");}},onSearch:function(aa){if(I.value==""||I.value==r){I.focus();return false;}var J="http://www.soso.com/q?bid=203&cid=webq.a&ie=utf-8&w="+encodeURIComponent(I.value);qqweb.portal.openInWebBrowser({url:J,title:"搜搜soso"});pgvSendClick({hottag:"web2qq.AppBar.wShortcut.SOSO"});},onSearchKeyClick:function(J){J.stopPropagation();},onClearDefaultApp:function(){var J=qqweb.config.getDefaultSetupAppList();for(var aa=0;aa<J.length;aa++){if(D.isInAppBar(J[aa])){D.removeAppButton(J[aa]);}}},onSpliterDragStart:function(J){D.hidePopup();this._spliterDragStartX=J.x;this._sdrag_appBarWidth=B.getClientWidth(E)-20;this._sdrag_sosoWidth=B.getClientWidth(C);this._sdrag_appBarLeftWidth=B.getClientWidth(L);},onSpliterDragMove:function(ac){var aa=ac.x;var ad=aa-this._spliterDragStartX;if(Math.abs(ad)>3){var ab=this._sdrag_appBarLeftWidth+ad;var J=this._sdrag_appBarWidth-this._sdrag_appBarLeftWidth-X-b-ad;if(ab<(this._sdrag_appBarWidth-X)&&ab>R){if(this._sdrag_appBarWidth-ab<b){B.hide(C);}else{if(j.browser.ie&&j.browser.ie==6){J=(J&1)==0?J:J-1;}J=(J<0)?0:J;B.setStyle(C,"width",J+"px");B.show(C);}B.setStyle(Y,"width",(ab-R)+"px");B.setStyle(L,"width",ab+"px");}}},onSpliterDragEnd:function(aa){var J=parseInt(B.getStyle(L,"width"));l.appBarLeftWidth=J;if(qqweb.portal.getLoginLevel()>1){qqweb.config.setAppBarSetting({appBarLeftWidth:J});}},onGetUserAppListSuccess:function(J){Y.innerHTML="";for(var aa in h){h[aa].destory();delete h[aa];}h=null;if(B.isShow(i)){D.hidePopup();}},onUpdateAppConfig:function(J){D.updateButton(J);},onAddAppConfig:function(ab){var aa=ab.id;var J=qqweb.config.getFolderIdById(aa);if(h){h[J].toggleDelButton();h[J].addAppItem(ab);}},onRemoveAppConfig:function(ab){var aa=ab.id;var J=qqweb.config.getFolderIdById(aa);if(h){h[J].removeAppItem(ab);h[J].toggleDelButton();}D.removeAppButton(ab);o();},onGetAppConfigComplete:function(ac){var ab=qqweb.config.getQuickAppList();for(var aa in ab){var J=qqweb.appconfig.getAppConfig(ab[aa]);if(J){D.addAppButton(J);}}l=qqweb.config.getAppBarSetting();l=l||{};l.appBarLeftWidth=j.isUndefined(l.appBarLeftWidth)?0:l.appBarLeftWidth;B.show(C);B.show(K);B.show(M);if(!j.cookie.get("notifyAppbar")){setTimeout(function(){var ad=B.getXY(M);B.setXY(H,ad[0]-92,ad[1]+39);B.show(H);},0);}G.onAdjustAppBar();},onAdjustAppBar:function(){B.setStyle(E,"width","");var ac=B.getClientWidth(E)-20;var ae=q*qqweb.config.getQuickAppList().length;var af=ac-R;var aa=(af>ae)?ae:af;if(j.browser.ie&&j.browser.ie<8){if(aa<0){return;}B.setStyle(Y,"width",aa+"px");B.setStyle(L,"width",(aa+R)+"px");}var ab=B.getClientWidth(L);if(parseInt(l.appBarLeftWidth)>=0){if(l.appBarLeftWidth==0){l.appBarLeftWidth=ac-v-b-X;}B.setStyle(Y,"width",(l.appBarLeftWidth-R)+"px");B.setStyle(L,"width",l.appBarLeftWidth+"px");ab=l.appBarLeftWidth;}var ag=ac-ab-X-b;if(ag>0){if(j.browser.ie&&j.browser.ie==6){ag=(ag&1)==0?ag:ag-1;}ag=(ag<0)?0:ag;B.setStyle(C,"width",ag+"px");B.show(C);}if(ac-X<ab){var ad=ac-X,J=ac-X-R;if(ad<0||J<0){return;}B.setStyle(L,"width",(ad)+"px");B.setStyle(Y,"width",(J)+"px");B.hide(C);}},onResizeAppBar:function(J){G.onAdjustAppBar();},onBarDragStart:function(){B.addClass(M,"appBar_controlBar_del");},onBarDragEnd:function(ac){B.removeClass(M,"appBar_controlBar_del");var ae,J,ab,af=ac.pos,aa=ac.apperceiveEl;ae=B.getXY(M);J=B.getClientWidth(M);ab=B.getClientHeight(M);if((af.x+30>ae[0]-J*0.5)&&(af.x+30<ae[0]+J*1.5)&&(af.y+25>ae[1]-ab*0.5)&&(af.y+25<ae[1]+ab*1.5)){var ad=aa.getAttribute("appId");if(confirm("是否删除快捷方式？")){qqweb.config.removeFromQuickAppList(ad);}else{if(ac.nextEl){ac.parentEl.insertBefore(aa,ac.nextEl);}else{ac.parentEl.appendChild(aa);}}}else{qqweb.config.setQuickQppList(ac.queue[0]);}},onBoxDragStart:function(J){B.setClass(P,"appBarBox_toolbar_del_hover");},onBoxDragEnd:function(ab){B.setClass(P,"appBarBox_toolbar_del");var ak,ai,ah,ad,ac,af,ag=ab.pos||{x:0,y:0},J=ab.apperceiveEl;ak=B.getXY(y);ah=B.getClientWidth(y);ac=B.getClientHeight(y);ai=B.getXY(P);ad=B.getClientWidth(P);af=B.getClientHeight(P);if((ag.x+30>ak[0])&&(ag.x+30<ak[0]+ah)&&(ag.y+25>ak[1])&&(ag.y+25<ak[1]+ac)){if(ab.nextEl){ab.parentEl.insertBefore(J,ab.nextEl);}else{ab.parentEl.appendChild(J);}var aj=J.getAttribute("appId");if(D.isInAppBar(aj)){alert("此快捷方式已存在");}else{if(qqweb.config.getQuickAppList().length>=20){alert("应用快捷方式最多可创建20个，请删减部分后再创建。");}else{if(confirm("是否创建快捷方式?")){var ae=Math.ceil((ag.x-ak[0])/65);qqweb.config.addToQuickAppList({appId:aj,index:ae});}}}}else{if((ag.x+30>ai[0])&&(ag.x+30<ai[0]+ad)&&(ag.y+25>ai[1])&&(ag.y+25<ai[1]+af)){if(ab.nextEl){ab.parentEl.insertBefore(J,ab.nextEl);}else{ab.parentEl.appendChild(J);}var aj=J.getAttribute("appId");var aa=qqweb.appconfig.getAppConfig(aj);if(aa&&confirm("是否将此应用删除?")){qqweb.config.removeSetupAppList(aa);o();}}else{qqweb.config.updateFolderList(ab.queue);o();}}},onPopupContainerMousedown:function(J){},onToolbarMarketClick:function(J){J.stopPropagation();J.preventDefault();if(qqweb.portal.getLoginLevel()>1){qqweb.portal.runApp("appMarket",{tab:2});D.hidePopup();pgvSendClick({hottag:"web2qq.AppBar.wmeun.marketButton2"});}else{x("您尚未登录，赶快登录去管理您喜爱的应用吧！");}},onDocumentClick:function(J){D.hidePopup();},stopPropagation:function(J){J.stopPropagation();},onAppbarTipButtonClick:function(J){B.hide(H);j.cookie.set("notifyAppbar",1,"qq.com","/",365*24);}};A.addObserver(this,"runFirst",G.onRunFirst);A.addObserver(this,"run",G.onRun);this.addAppButton=function(J,ac){var ah,ag;if(J.id){ah=J;ag=ah.id;}else{ag=J;ah=qqweb.appconfig.getAppConfig(ag);}if(this.isInAppBar(ag)){return;}var ae=ah.exinfo.reportName;var aa=B.node("div",{id:"appBar_"+ah.id+"Button","class":"appButton",appId:ah.id,title:ah.appName,appId:ah.id,appName:ae?ae:""});var ab='<div class="appIcon" id="appBar_appIcon_'+ag+'" isLoadIcon="0"></div><div id="appBar_appIcon_text_'+ag+'" class="appText">'+s.encodeHtml(String(ah.appName))+"</div>";aa.innerHTML=ab;if(ac){var af=Y.childNodes;if(af[ac]){Y.insertBefore(aa,af[ac]);}else{Y.appendChild(aa);}}else{Y.appendChild(aa);}var ad=B.id("appBar_appIcon_"+ag);N(ad,ag,ah.iconUrl);U.addDragClass(aa);A.on(aa,"customclick",G.onClickAppStartButton);A.notifyObservers(D,"addAppButton",ag);};this.updateButton=function(J){var ab=J.id;if(this.isInAppBar(ab)){var aa=B.id("appBar_appIcon_text_"+ab);if(aa){aa.innerHTML=s.encodeHtml(J.appName);}}};this.removeAppButton=function(aa){var J,ad;if(aa.id){J=aa;ad=J.id;}else{ad=aa;J=qqweb.appconfig.getAppConfig(ad);}var ac=B.id("appBar_"+ad+"Button");if(ac){var ab=ac.parentNode;ab.removeChild(ac);A.notifyObservers(D,"removeAppButton",ad);}};this.isInAppBar=function(aa){var J=B.id("appBar_"+aa+"Button");if(J){return true;}else{return false;}};this.toggleAppButton=function(J){if(this.isInAppBar(J)){this.removeAppButton(J);}else{this.addAppButton(J);}};this.togglePopup=function(){if(V){this.hidePopup();}else{this.showPopup();}};this.adjustPopupScrollBar=function(){if(D.scrollBar){D.scrollBar.setBarHeight();}};this.showPopup=function(){V=true;B.show(i);var ac,ab,aa,J;ac=B.getXY(M);ab=B.getClientWidth(M);aa=B.getClientWidth(i);J=ac[0]+ab-aa+10;J=J>90?J:90;B.setStyle(i,"left",J+"px");B.setStyle(i,"top",53+"px");B.setStyle(i,"zIndex",qqweb.layout.getTopZIndex());B.show(i);M.className="appBar_controlBar_allExpand";A.on(document,"click",G.onDocumentClick);D.adjustPopupScrollBar();o();pgvSendClick({hottag:"web2qq.AppBar.wmeun.more"});};this.hidePopup=function(){V=false;B.hide(i);M.className="appBar_controlBar_all";A.off(document,"click",G.onDocumentClick);};this.addMySignatureButton=function(J){qqweb.app.appBar.addAppButton(J);};A.addObserver(qqweb,"runMySignature",D.addMySignatureButton);this.FolderItem=new j.Class({init:function(aa,J){this.folder=aa;this.folderId=aa.id;this.name=aa.name;this.list=aa.list;this.appItemList={};this.parentEl=J;this.addFolderItem();this.addAppItems();this.isExpand=false;},addFolderItem:function(){this.forderItemEl=B.node("div",{id:"appBox_category_"+this.folderId,"class":"appBox_category",folderId:this.folderId});var J='<a id ="appBox_cateDropdown_'+this.folderId+'" class="appBox_cateDropdown" href ="###" hidefocus></a>						<a id="appBox_category_title_'+this.folderId+'" class="appBox_category_title" href="###">'+s.encodeHtml(this.name)+'</a>						<label for="appBox_category_title_input_'+this.folderId+'">							<input id="appBox_category_title_input_'+this.folderId+'" class="appBox_category_title_input" type="text" maxlength="8"/>						</label>						<a id="appBox_folder_del_'+this.folderId+'" class="appBox_folder_del" href="###" title="删除">&nbsp&nbsp</a>						<div id="appBox_iconlist_'+this.folderId+'" class="appBox_iconlist"></div>						<a id="appBox_addapp_'+this.folderId+'" class="appBox_addapp" href ="###"></a>';this.forderItemEl.innerHTML=J;this.parentEl.appendChild(this.forderItemEl);this.iconListEl=B.id("appBox_iconlist_"+this.folderId);this.categoryEl=B.id("appBox_category_"+this.folderId);this.cateDropdownEl=B.id("appBox_cateDropdown_"+this.folderId);this.titleEl=B.id("appBox_category_title_"+this.folderId);this.inputEl=B.id("appBox_category_title_input_"+this.folderId);this.addEl=B.id("appBox_addapp_"+this.folderId);this.delEl=B.id("appBox_folder_del_"+this.folderId);W.addDropTarget(this.iconListEl);A.on(this.addEl,"click",j.bind(this.observer.onAddClick,this));A.on(this.delEl,"click",j.bind(this.observer.onDelClick,this));A.on(this.titleEl,"click",j.bind(this.observer.onTitleClick,this));A.on(this.titleEl,"mouseover",j.bind(this.observer.onTitleMouseover,this));A.on(this.titleEl,"mouseout",j.bind(this.observer.onTitleMouseout,this));A.on(this.inputEl,"blur",j.bind(this.observer.onInputBlur,this));A.on(this.inputEl,"click",j.bind(this.observer.onInputClick,this));A.on(this.cateDropdownEl,"click",j.bind(this.observer.onClickFolderDropdown,this));},addAppItems:function(){var aa=qqweb.appconfig.getAppConfigList();var ab=this.list;var ad=(new Date()).getTime();var J=this;var ac=function(){j.out("我的应用渲染回调时间:"+((new Date()).getTime()-ad));for(var ae in J.appItemList){W.addDragClass(J.appItemList[ae].appItemEl);}};j.timedChunk(ab,function(ae){if(ae){J.addAppItem(aa[ae]);}},D,false,ac);},addAppItem:function(J){if(J){this.appItemList[J.id]=new qqweb.app.appBar.AppItem(J,this.iconListEl);}},removeAppItem:function(aa){var J=B.id("appBox_appItem_"+aa.id);J.parentNode.removeChild(J);delete this.appItemList[aa.id];},removeFolderItem:function(){W.removeDropTarget(this.iconListEl);this.parentEl.removeChild(this.forderItemEl);},updateFolderName:function(J){this.name=(this.inputEl.value).substring(0,16);qqweb.config.updateFloderName(this.folderId,this.name);this.titleEl.innerHTML=s.encodeHtml(J);},toggleDelButton:function(){var J=qqweb.config.getFolderById(this.folderId).list.length;if(J==0){if(this.folderId!=4){B.show(this.delEl);B.setStyle(this.titleEl,"width","auto");}else{B.hide(this.delEl);}B.show(this.addEl);B.hide(this.cateDropdownEl);this.hideList();}else{B.hide(this.delEl);B.show(this.addEl);B.hide(this.addEl);B.show(this.cateDropdownEl);}if(J<7){B.hide(this.cateDropdownEl);this.hideList();}else{B.show(this.cateDropdownEl);}},toggleList:function(){if(!this.isExpand){this.expandList();}else{this.hideList();}D.adjustPopupScrollBar();},expandList:function(){var J=B.getClientHeight(this.iconListEl);if(J<c){J=c;}B.addClass(this.iconListEl,"expand");B.addClass(this.cateDropdownEl,"expand");if(j.browser.ie&&j.browser.ie<8){var ab=qqweb.config.getFolderById(this.folderId).list.length/t;ab=(ab>Math.floor(ab))?Math.floor(ab)+1:Math.floor(ab);var aa=ab*c;B.setStyle(this.iconListEl,"height",aa+"px");if(j.browser.ie==6){B.setStyle(this.categoryEl,"height",(Z-c)+aa+"px");}}this.isExpand=true;},hideList:function(){B.removeClass(this.iconListEl,"expand");B.removeClass(this.cateDropdownEl,"expand");if(j.browser.ie&&j.browser.ie<8){B.setStyle(this.iconListEl,"height",c+"px");if(j.browser.ie==6){B.setStyle(this.categoryEl,"height",Z+"px");}}this.isExpand=false;},destory:function(){this.parentEl.removeChild(this.forderItemEl);},observer:{onClickFolderDropdown:function(J){J.stopPropagation();J.preventDefault();this.toggleList();},onTitleClick:function(J){J.preventDefault();J.stopPropagation();B.hide(this.titleEl);B.show(this.inputEl);this.inputEl.value=this.name;this.inputEl.focus();this.inputEl.select();},onTitleMouseover:function(J){B.setStyle(this.titleEl,"width","115px");},onTitleMouseout:function(J){B.setStyle(this.titleEl,"width","auto");},onInputBlur:function(aa){B.hide(this.inputEl);B.show(this.titleEl);var J=s.trim(this.inputEl.value);if(J==""){alert("名字不能为空!");}else{this.updateFolderName(this.inputEl.value);}},onInputClick:function(J){J.stopPropagation();},onDelClick:function(J){if(confirm("是否删除应用分组？")){qqweb.config.removeFolderByFolderId(this.folderId);pgvSendClick({hottag:"web2qq.AppBar.wmeun.bracketremove"});}},onAddClick:function(J){if(qqweb.portal.getLoginLevel()==1){x("您尚未登录，赶快登录去管理您喜爱的应用吧！");return;}if(this.folderId==4&&j.array.indexOf(qqweb.config.getSetupAppList(),6)>-1){qqweb.portal.runApp(6);}else{qqweb.portal.runApp("appMarket",{tab:2});}D.togglePopup();pgvSendClick({hottag:"web2qq.AppBar.wmeun.marketbracket"});}}});this.AppItem=new j.Class({init:function(aa,J){this.parentEl=J||B.id("appBar_iconlist_inner_4");this.app=aa;this.addAppItem();},addAppItem:function(){var aa=this.app;this.appItemEl=B.node("div",{id:"appBox_appItem_"+aa.id,"class":"appBox_appItem",appId:aa.id});var J='<div class="appBox_appIcon_container" id="appBox_appIcon_container_'+aa.id+'">							<div class="appBox_appIcon" id="appBox_appIcon_'+aa.id+'"></div>						</div>						<span class="appBox_appName" id="appBox_appName_'+aa.id+'">'+s.encodeHtml(String(aa.appName))+"</span>";this.appItemEl.innerHTML=J;this.parentEl.appendChild(this.appItemEl);this.iconContainerEl=B.id("appBox_appIcon_container_"+aa.id);this.iconEl=B.id("appBox_appIcon_"+aa.id);this.setIcon(this.iconEl,aa.id,aa.iconUrl);A.on(this.iconContainerEl,"mouseover",j.bind(this.onIconContainerElMouseover,this));A.on(this.iconContainerEl,"mouseout",j.bind(this.onIconContainerElMouseout,this));A.on(this.appItemEl,"customclick",j.bind(this.onAppItemElClick,this));},setAppName:function(J){this.titleTextEl.innerHTML=s.encodeHtml(String(J));},setIcon:function(J,ae,ab){var ad=qqweb.CONST.PUB_APP_STATIC_URL+Math.floor(ae/1000)%1000+"/"+ae+"/images/";var af=qqweb.CONST.PRI_APP_STATIC_URL;if(ab&&ab.smallIcon){if(ab.smallIcon.indexOf("priapps")>-1){af=qqweb.CONST.PRI_APP_STATIC_URL2;}}var ag="";var aa=ab.type||ab;if((aa&"010")>0){if(ae>99999){ag=af+ab.midIcon;}else{ag=ad+"mid.png";}J.style.backgroundImage="url("+ag+")";qqweb.util.setPngForIE6(J,ag);}else{if((aa&"001")>0){if(ae>99999){ag=af+ab.smallIcon;}else{ag=ad+"small.png";}J.style.backgroundImage="url(./module/appbar/images/iconbg_3.png)";qqweb.util.setPngForIE6(J,"./module/appbar/images/iconbg_3.png");var ac=B.node("div",{"class":"AppBar_item_small_icon"});J.appendChild(ac);ac.style.backgroundImage="url("+ag+")";qqweb.util.setPngForIE6(ac,ag);}else{J.style.backgroundImage="url(./module/appbar/images/mid.png)";qqweb.util.setPngForIE6(J,"./module/appbar/images/mid.png");}}},onIconContainerElMouseover:function(){B.setStyle(this.delEl,"display","block");if(j.browser.ie&&j.browser.ie==6){B.addClass(this.appItemEl,"hover");}},onIconContainerElMouseout:function(){B.setStyle(this.delEl,"display","none");if(j.browser.ie&&j.browser.ie==6){B.removeClass(this.appItemEl,"hover");}},onAppItemElClick:function(J){qqweb.portal.runApp(this.app.id);D.hidePopup();var aa=this.app.reportName;if(aa&&s.trim(aa)){pgvSendClick({hottag:"web2qq.AppBar.meunapp."+aa});}},onDelElClick:function(J){J.stopPropagation();if(confirm("是否删除应用？")){qqweb.config.removeSetupAppList(this.app);}}});});
