<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>EQQ Proxy 2010</title>
</head>
<body>
<script>
document.domain = "qq.com";


//  Adapter 
if(typeof window.XMLHttpRequest === "undefined"){
	window.XMLHttpRequest = function(){
		return new window.ActiveXObject(navigator.userAgent
			.indexOf("MSIE 5") >=0 ? "Microsoft.XMLHTTP" 
			: "Msxml2.XMLHTTP");
	};
}


/**
 * Ajax
 * 
 * @memberOf Http
 * @methodajax
 * 
 * @param {Object} options 
 * @return {Object} ajax ajax
 */
var ajax = function(uri, options){
	var httpRequest,httpSuccess,timeout,isTimeout = false,isComplete = false;
	options = {
		method: options.method || "GET",
		data: options.data || null,
		arguments: options.arguments || null,
		onSuccess: options.onSuccess || function(){},
		onError: options.onError || function(){},
		onComplete: options.onComplete || function(){},
		//
		onTimeout: options.onTimeout || function(){},
		isAsync: options.isAsync || true,
		timeout: options.timeout ? options.timeout : 30000,
		contentType: options.contentType ? options.contentType : "utf-8",
		type: options.type || "xml"
	};
	uri = uri || "",
	timeout = options.timeout;

	httpRequest = new window.XMLHttpRequest();

	httpRequest.open(options.method, uri, options.isAsync);
	//
	//httpRequest.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
	httpRequest.setRequestHeader("Content-Type",options.contentType);

	/**
	 * @ignore
	 */
	httpSuccess=function(r){
		try{
			return (!r.status && location.protocol == "file:")
				|| (r.status>=200 && r.status<300)
				|| (r.status==304)
				|| (navigator.userAgent.indexOf("Safari")>-1 
					&& typeof r.status=="undefined");
		}catch(e){}
		return false;
	}

	httpRequest.onreadystatechange=function (){
		if(httpRequest.readyState==4){
			if(!isTimeout){
				var o={};
				o.responseText = httpRequest.responseText;
				o.responseXML = httpRequest.responseXML;
				o.uri=uri;
				o.arguments=options.arguments;
				o.status= httpRequest.status;
				o.data = options.data;
	
				if(httpSuccess(httpRequest)){
					if(options.type === "script"){
						eval.call(window, data);
					}
					try{
						if(options && options.onSuccess){
							options.onSuccess(o);
						}
					}catch(e){}
				}else{	
					try{
						options.onError(o);
					}catch(e){}
				}
				try{
					options.onComplete(o);
				}catch(e){}
			}
			isComplete = true;
			//,
			httpRequest = null;
		}
	};

	httpRequest.send(options.data);
	window.setTimeout(function(){
		var o;
		if(!isComplete){
			isTimeout = true;
			o={};
			o.uri=uri;
			o.arguments=options.arguments;
			if(httpRequest){
				httpRequest.abort();
				httpRequest = null;
			}
		try{
			options.onTimeout(o);
			options.onComplete(o);
		}catch(e){}
		}
	}, timeout);
	return httpRequest;
};
</script>

</body>
</html>
